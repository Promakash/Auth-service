# test-task-backend

**Используемые технологии:**

- Go
- JWT
- PostgreSQL

**Задание:**

Написать часть сервиса аутентификации.

Два REST маршрута:

- Первый маршрут выдает пару Access, Refresh токенов для пользователя с идентификатором (GUID) указанным в параметре запроса
- Второй маршрут выполняет Refresh операцию на пару Access, Refresh токенов

**Требования:**

Access токен тип JWT, алгоритм SHA512, хранить в базе строго запрещено.

Refresh токен тип произвольный, формат передачи base64, хранится в базе исключительно в виде bcrypt хеша, должен быть защищен от изменения на стороне клиента и попыток повторного использования.

Access, Refresh токены обоюдно связаны, Refresh операцию для Access токена можно выполнить только тем Refresh токеном который был выдан вместе с ним.

Payload токенов должен содержать сведения об ip адресе клиента, которому он был выдан. В случае, если ip адрес изменился, при рефреш операции нужно послать email warning на почту юзера (для упрощения можно использовать моковые данные).

**Реализация:**\
Реализованы все требования, написана документация, а так же сервис контейнезирован и покрыт тестами \
Тестами покрыты все основные кейсы взаимодействия пользователя с API\
Документация:
[http://localhost:8080/api/v1/auth/docs/index.html](http://localhost:8080/api/v1/auth/docs/index.html)

**Требования:** \
Go - 1.22.5 и выше \
Docker compose v2 (v1 тоже работает, но тогда нельзя использовать Makefile для запуска)

**Локальный запуск:** \
`make build_launch` - сбилдить и запустить сервис\
`make build_launch_tests` - сбилдить и запустить сервис с тестами\
`make stop` - остановить сервис

**Настройка проекта:** \
В папке `config` находится конфиг сервиса 

**Параметры конфига:**

```
address: ":8080"           # Адрес, на котором будет запускаться сервис

postgres:                  # Конфиг PostgreSQL:
  host: storage            # Хост бд
  port: 5432               # Порт бд
  user: postgres           # Имя пользователя 
  password: password       # Пароль пользователя
  db_name: postgres        # Имя бд

log:                       # Конфиг логгера:
  level: debug             # Уровень логирования (debug, info, warn, error)
  format: json             # Формат логов (text, json)

jwt:                       # Конфиг токенов:
  secret: "super-secret-key" # Секрет для подписи JWT токенов
  refreshExp: 80           # Время жизни Refresh токена (в днях)
  accessExp: 1             # Время жизни Access токена (в днях)

smtp:                      # Конфигурация SMTP
  host: "tests"            # Хост SMTP
  port: "2525"             # Порт SMTP
  username: "test"         # Имя пользователя
  password: "test"         # Пароль
```
**Примечания:** \
У SMTP сервиса отправки сообщений отключена auth, чтобы тестировать локально